# Code-reader æ•°æ®å­˜å‚¨ä½ç½®è¯´æ˜

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜ Code-reader ç³»ç»Ÿä¸­æ‰€æœ‰æ•°æ®çš„å­˜å‚¨ä½ç½®å’Œç”¨é€”ã€‚

---

## ğŸ“Š æ•°æ®å­˜å‚¨æ¦‚è§ˆ

```
Code-reader ç³»ç»Ÿæ•°æ®åˆ†å¸ƒ:
â”œâ”€â”€ MySQL æ•°æ®åº“ (ç»“æ„åŒ–æ•°æ®)
â”œâ”€â”€ æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ (ä»£ç ä»“åº“ã€ç¼“å­˜ã€æ—¥å¿—)
â”œâ”€â”€ å‘é‡æ•°æ®åº“ (RAG æ£€ç´¢)
â””â”€â”€ deepwiki æ•°æ® (æ–‡æ¡£ç”Ÿæˆ)
```

---

## 1ï¸âƒ£ MySQL æ•°æ®åº“ (ä¸»æ•°æ®åº“)

### ğŸ“ ä½ç½®
- **ä¸»æœº**: `localhost:3306`
- **æ•°æ®åº“å**: `code_reader` (é»˜è®¤) æˆ– `code_analysis`
- **ç”¨æˆ·**: `root`
- **å¯†ç **: `123456`

### ğŸ“¦ å­˜å‚¨å†…å®¹
| è¡¨å | ç”¨é€” | æ•°æ®é‡ |
|------|------|--------|
| `repositories` | ä»“åº“åŸºæœ¬ä¿¡æ¯ | æ¯ä¸ªé¡¹ç›® 1 æ¡è®°å½• |
| `analysis_tasks` | åˆ†æä»»åŠ¡è®°å½• | æ¯ä¸ªåˆ†æ 1 æ¡è®°å½• |
| `file_analyses` | æ–‡ä»¶åˆ†æç»“æœ | æ¯ä¸ªæ–‡ä»¶ 1 æ¡è®°å½• |
| `analysis_items` | åˆ†æé¡¹è¯¦æƒ… | æ¯ä¸ªä»£ç å…ƒç´  1 æ¡è®°å½• |
| `task_readmes` | ç”Ÿæˆçš„æ–‡æ¡£ | æ¯ä¸ªä»»åŠ¡ 1 æ¡è®°å½• |

### ğŸ”§ é…ç½®æ–‡ä»¶
- `Code-reader/backend/config.py`
- ç¯å¢ƒå˜é‡: `DB_HOST`, `DB_PORT`, `DB_NAME`, `DB_USER`, `DB_PASSWORD`

### ğŸ’¾ æ•°æ®å¤§å°
- å–å†³äºé¡¹ç›®æ•°é‡å’Œæ–‡ä»¶æ•°é‡
- å¹³å‡æ¯ä¸ªé¡¹ç›®: 1-10MB

---

## 2ï¸âƒ£ æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ

### ğŸ“ Code-reader/backend/data/

#### 2.1 ä¸Šä¼ çš„ä»£ç ä»“åº“
**ä½ç½®**: `Code-reader/backend/data/repos/`

**ç»“æ„**:
```
repos/
â”œâ”€â”€ 5ba9872e407c47d28241371a7acd3ce5/  â† ä»“åº“ 1 (MD5 å“ˆå¸Œ)
â”‚   â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ tests/
â”‚   â””â”€â”€ ...
â”œâ”€â”€ 84613d8aff282a43c6f3dc6c3573ac25/  â† ä»“åº“ 2
â”‚   â””â”€â”€ ...
â””â”€â”€ ...
```

**ç”¨é€”**:
- å­˜å‚¨ç”¨æˆ·ä¸Šä¼ çš„ä»£ç ä»“åº“
- ç”¨äºä»£ç åˆ†æå’Œæ–‡ä»¶è¯»å–

**æ•°æ®å¤§å°**:
- å–å†³äºä¸Šä¼ çš„é¡¹ç›®å¤§å°
- ç¤ºä¾‹: æ¯ä¸ªé¡¹ç›® 500KB - 50MB

**æ¸…ç†æ–¹å¼**:
```bash
# æ‰‹åŠ¨æ¸…ç†
cd Code-reader
./clean-residual-files.sh

# æˆ–åˆ é™¤æ•´ä¸ªç›®å½•
rm -rf Code-reader/backend/data/repos/*
```

#### 2.2 LLM ç¼“å­˜
**ä½ç½®**: `Code-reader/backend/data/cache/llm/`

**ç”¨é€”**:
- ç¼“å­˜ LLM API å“åº”
- å‡å°‘é‡å¤è°ƒç”¨,èŠ‚çœæˆæœ¬

**æ•°æ®å¤§å°**: é€šå¸¸å¾ˆå° (< 1MB)

#### 2.3 å‘é‡å­˜å‚¨
**ä½ç½®**: `Code-reader/backend/data/vectorstores/`

**ç”¨é€”**:
- å­˜å‚¨ä»£ç å‘é‡ç´¢å¼• (å¦‚æœä½¿ç”¨æœ¬åœ°å‘é‡åº“)
- ç›®å‰ä¸ºç©º (ä½¿ç”¨å¤–éƒ¨ RAG æœåŠ¡)

**æ•°æ®å¤§å°**: 0B (å½“å‰æœªä½¿ç”¨)

#### 2.4 åˆ†æç»“æœ
**ä½ç½®**: `Code-reader/backend/data/results/`

**ç”¨é€”**:
- å­˜å‚¨ä¸´æ—¶åˆ†æç»“æœ
- ç›®å‰ä¸ºç©º

**æ•°æ®å¤§å°**: 0B (å½“å‰æœªä½¿ç”¨)

---

### ğŸ“ Code-reader/backend/logs/

**ä½ç½®**: `Code-reader/backend/logs/`

**æ–‡ä»¶**:
```
logs/
â”œâ”€â”€ backend.log           â† å½“å‰æ—¥å¿— (è½¯é“¾æ¥)
â”œâ”€â”€ app_20251114.log      â† å†å²æ—¥å¿—
â”œâ”€â”€ app_20251115.log      â† å†å²æ—¥å¿—
â””â”€â”€ ...
```

**ç”¨é€”**:
- åç«¯æœåŠ¡è¿è¡Œæ—¥å¿—
- é”™è¯¯è¿½è¸ªå’Œè°ƒè¯•

**æ•°æ®å¤§å°**: 
- æ¯å¤© 10-100KB
- å»ºè®®å®šæœŸæ¸…ç†æ—§æ—¥å¿—

**æ¸…ç†æ–¹å¼**:
```bash
# åˆ é™¤ 7 å¤©å‰çš„æ—¥å¿—
find Code-reader/backend/logs -name "app_*.log" -mtime +7 -delete
```

---

### ğŸ“ Code-reader/frontend/logs/

**ä½ç½®**: `Code-reader/frontend/logs/`

**ç”¨é€”**:
- å‰ç«¯å¼€å‘æœåŠ¡å™¨æ—¥å¿—
- Vite æ„å»ºæ—¥å¿—

**æ•°æ®å¤§å°**: é€šå¸¸å¾ˆå° (< 10KB)

---

## 3ï¸âƒ£ å‘é‡æ•°æ®åº“ (RAG æœåŠ¡)

### ğŸ“ ä½ç½®
**ç›®å½•**: `local-rag-service/chroma_data/`

**ç»“æ„**:
```
chroma_data/
â”œâ”€â”€ chroma.sqlite3                              â† ChromaDB å…ƒæ•°æ® (13MB)
â”œâ”€â”€ 1deaa243-f4b9-4bbf-ad8e-b8f3934ff3af/      â† é›†åˆ 1
â”œâ”€â”€ 47392d78-44fd-4ea2-b08e-246c561958f8/      â† é›†åˆ 2
â”œâ”€â”€ 4af97997-becf-4ea5-bbf4-e06fdb763a0f/      â† é›†åˆ 3
â”œâ”€â”€ 540775e9-dfad-471a-a256-5dfee5088200/      â† é›†åˆ 4
â””â”€â”€ fb8e06b9-2ee9-4390-8a71-bf53b3dabebc/      â† é›†åˆ 5
```

### ğŸ“¦ å­˜å‚¨å†…å®¹
- ä»£ç å‘é‡åµŒå…¥ (Embeddings)
- ç”¨äº RAG æ£€ç´¢å’Œè¯­ä¹‰æœç´¢

### ğŸ’¾ æ•°æ®å¤§å°
- å½“å‰: **15MB**
- æ¯ä¸ªé¡¹ç›®: çº¦ 2-5MB

### ğŸ”§ æœåŠ¡
- **ç«¯å£**: `32421`
- **API**: `http://localhost:32421`

### ğŸ—‘ï¸ æ¸…ç†æ–¹å¼
```bash
# åœæ­¢ RAG æœåŠ¡
pkill -f "uvicorn.*32421"

# åˆ é™¤æ‰€æœ‰å‘é‡æ•°æ®
rm -rf local-rag-service/chroma_data/*

# é‡å¯ RAG æœåŠ¡
cd local-rag-service
.venv/bin/python -m uvicorn main:app --host 0.0.0.0 --port 32421
```

---

## 4ï¸âƒ£ deepwiki æ•°æ®

### ğŸ“ ä½ç½®
**ç›®å½•**: `deepwiki-open/data/`

**æ–‡ä»¶**:
```
data/
â”œâ”€â”€ 9b5ad71b2ce5302211f9c61530b329a4922fc6a4  â† æ–‡æ¡£æ•°æ® 1
â”œâ”€â”€ fb374d419588a4632f3f557e76b4b70aebbca790  â† æ–‡æ¡£æ•°æ® 2
â””â”€â”€ README.md
```

### ğŸ“¦ å­˜å‚¨å†…å®¹
- deepwiki ç”Ÿæˆçš„æ–‡æ¡£æ•°æ®
- ä¸´æ—¶æ–‡ä»¶å’Œç¼“å­˜

### ğŸ’¾ æ•°æ®å¤§å°
- å½“å‰: **4KB** (å·²æ¸…ç†)
- æ­£å¸¸: æ¯ä¸ªé¡¹ç›® 1-5MB

### ğŸ—‘ï¸ æ¸…ç†æ–¹å¼
```bash
# ä¿ç•™ README.md,åˆ é™¤å…¶ä»–æ–‡ä»¶
find deepwiki-open/data -type f ! -name "README.md" -delete
```

---

## ğŸ“Š æ€»æ•°æ®é‡ç»Ÿè®¡

| ä½ç½® | å½“å‰å¤§å° | è¯´æ˜ |
|------|----------|------|
| MySQL æ•°æ®åº“ | ~10MB | ç»“æ„åŒ–æ•°æ® |
| ä»£ç ä»“åº“ | 12KB | å·²æ¸…ç† |
| å‘é‡æ•°æ®åº“ | 15MB | RAG æ£€ç´¢ |
| deepwiki æ•°æ® | 4KB | å·²æ¸…ç† |
| åç«¯æ—¥å¿— | 76KB | è¿è¡Œæ—¥å¿— |
| å‰ç«¯æ—¥å¿— | 4KB | å¼€å‘æ—¥å¿— |
| **æ€»è®¡** | **~25MB** | å½“å‰å ç”¨ |

---

## ğŸ§¹ å®Œæ•´æ¸…ç†è„šæœ¬

å·²åˆ›å»ºæ¸…ç†è„šæœ¬: `Code-reader/clean-residual-files.sh`

**ä½¿ç”¨æ–¹æ³•**:
```bash
cd Code-reader
./clean-residual-files.sh
```

**æ¸…ç†å†…å®¹**:
- âœ… ä¸Šä¼ çš„ä»£ç ä»“åº“ (`backend/data/repos/`)
- âœ… deepwiki æ•°æ®æ–‡ä»¶ (`../deepwiki-open/data/`)
- âœ… å‘é‡æ•°æ®åº“ (`../local-rag-service/chroma_data/`) **[æ–°å¢]**

**æ™ºèƒ½åŠŸèƒ½**:
- ğŸ” è‡ªåŠ¨æ£€æµ‹ RAG æœåŠ¡çŠ¶æ€
- ğŸ›‘ æ¸…ç†å‰æç¤ºåœæ­¢ RAG æœåŠ¡
- ğŸ’¡ æ¸…ç†åæç¤ºé‡å¯ RAG æœåŠ¡
- âš ï¸ æ¸…ç†å‰æ˜¾ç¤ºè¯¦ç»†æ¸…å•å¹¶ç¡®è®¤

**ä¸æ¸…ç†**:
- âŒ MySQL æ•°æ®åº“
- âŒ æ—¥å¿—æ–‡ä»¶

---

## ğŸ’¡ æ•°æ®å¤‡ä»½å»ºè®®

### 1. MySQL æ•°æ®åº“å¤‡ä»½
```bash
mysqldump -h localhost -P 3306 -u root -p123456 code_reader > backup.sql
```

### 2. ä»£ç ä»“åº“å¤‡ä»½
```bash
tar -czf repos_backup.tar.gz Code-reader/backend/data/repos/
```

### 3. å‘é‡æ•°æ®åº“å¤‡ä»½
```bash
tar -czf chroma_backup.tar.gz local-rag-service/chroma_data/
```

---

## ğŸ”„ æ•°æ®æ¢å¤

### 1. æ¢å¤ MySQL æ•°æ®åº“
```bash
mysql -h localhost -P 3306 -u root -p123456 code_reader < backup.sql
```

### 2. æ¢å¤ä»£ç ä»“åº“
```bash
tar -xzf repos_backup.tar.gz -C Code-reader/backend/data/
```

### 3. æ¢å¤å‘é‡æ•°æ®åº“
```bash
tar -xzf chroma_backup.tar.gz -C local-rag-service/
```

---

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **åˆ é™¤é¡¹ç›®æ—¶**:
   - è½¯åˆ é™¤: åªæ ‡è®°æ•°æ®åº“è®°å½•,ä¸åˆ é™¤æ–‡ä»¶
   - ç¡¬åˆ é™¤: åˆ é™¤æ•°æ®åº“è®°å½• + ç£ç›˜æ–‡ä»¶ (å·²ä¼˜åŒ–)

2. **å®šæœŸæ¸…ç†**:
   - å»ºè®®æ¯æœˆè¿è¡Œæ¸…ç†è„šæœ¬
   - æ¸…ç†æ—§æ—¥å¿—æ–‡ä»¶ (> 7 å¤©)

3. **æ•°æ®å®‰å…¨**:
   - é‡è¦æ•°æ®è¯·å®šæœŸå¤‡ä»½
   - æ¸…ç†å‰è¯·ç¡®è®¤æ•°æ®ä¸å†éœ€è¦

---

**æœ€åæ›´æ–°**: 2025-11-15

